let contratos=[],$body=document.querySelector("#bodyTableContratos"),btnSaveContrato=document.getElementById("btnSaveContrato"),btnUpdateContrato=document.getElementById("btnUpdateContrato"),formContratoRegister=document.getElementById("formContratoRegister");formContratoRegister.addEventListener("submit",ajaxFormRegisterContrato);let formContratoUpdate=document.getElementById("formContratoUpdate");formContratoUpdate.addEventListener("submit",ajaxFormUpdateContrato);const info=()=>{if(0==contratos.length){const a=document.createElement("tr");let b=document.createElement("td");b.setAttribute("colspan",7),b.setAttribute("id","infoTable"),b.textContent="Sin datos",a.appendChild(b),$body.appendChild(a)}},getData=async()=>{try{const a=await axios.get(`${SITEURL}/contratos`);contratos=Object.values((await a).data),0<contratos.length&&(await drawTable(contratos,$body,"Contrato"),null!=document.getElementById("infoTable")&&document.getElementById("infoTable").remove())}catch(a){console.error(a)}};async function ajaxFormRegisterContrato(a){a.preventDefault(),btnSaveContrato.value="Enviando...",btnSaveContrato.disabled=!0;const b=new FormData(formContratoRegister);console.log(formContratoRegister);await axios.post(formContratoRegister.action,b).then(a=>{console.log(a),refresh(a.data.message),$("#formContratoRegister").trigger("reset"),$("#modalContratoRegister").modal("hide")}).catch(a=>{if(a.response.data.errors){for(var b in a.response.data.errors){let c=formContratoRegister.elements.namedItem(b);c.classList.add("is-invalid"),toastr.error(`<li> ${a.response.data.errors[b]} </li>`)}console.error(a.response.data)}});document.getElementById("btnSaveContrato").value="Enviar",btnSaveContrato.disabled=!1}async function ajaxFormUpdateContrato(a){a.preventDefault(),btnUpdateContrato.value="Enviando...",btnUpdateContrato.disabled=!0;const b=new FormData(formContratoUpdate),c=await axios.post(formContratoUpdate.action,b).then(a=>{refresh(a.data),console.log(a.data),$("#formContratoUpdate").trigger("reset"),$("#modalContratoUpdate").modal("hide")}).catch(a=>{for(var b in a.response.data.errors){let c=formContratoUpdate.elements.namedItem(b);c.classList.add("is-invalid"),warning=document.createTextNode(`${a.response.data.errors[b]}`),insertAfter(warning,c)}});document.getElementById("btnUpdateContrato").value="Enviar",btnUpdateContrato.disabled=!1}function eliminarContrato(a){toastr.options.preventDuplicates=!0,toastr.info("<br /><button class='btn btn-sm btn-danger m-1' type='button' value='yes'>Yes</button> <button class='btn btn-sm btn-warning m-1' type ='button'  value='no' > No </button>","Desea eliminar este elemento ?",{allowHtml:!0,onclick:async function(b){if(value=b.target.value,"yes"==value){const b=`${SITEURL}/contratos/${a}`;try{const a=await axios.delete(b);refresh(a.data.data)}catch(a){toastr.remove(),console.error(a)}}else toastr.remove()}})}async function editarContrato(a){const b=SITEURL+"/contratos/"+a,c=await axios.get(b);switch(c.status){case 200:console.log(c),formContratoUpdate.id.value=c.data.data.id,formContratoUpdate.observaciones.value=c.data.data.observaciones,formContratoUpdate.fin.value=c.data.data.fin,formContratoUpdate.inicio.value=c.data.data.inicio,formContratoUpdate.inmueble_id.value=c.data.data.inmueble.codigo,formContratoUpdate.arrendatario_id.value=c.data.data.arrendatario.identificacion,document.getElementById("canon").value=currency(c.data.data.inmueble.canon).format(),document.getElementById("administracion").value=currency(c.data.data.inmueble.administracion).format(),$("#modalContratoUpdate").modal("show");break;default:}}const refresh=async a=>{$body.innerHTML="",getData(),await toastr.remove(),await toastr.info("Success:",a)};document.hasFocus()&&(info(),getData()),settCanon=async()=>{try{let a=document.querySelector(".canon"),b=document.querySelector(".administracion"),c=document.getElementById("customID");const d=await axios.get(`${SITEURL}/search/${c.value}`);a.value=currency(d.data.data.canon).format(),b.value=currency(d.data.data.administracion).format()}catch(a){console.error(a)}};